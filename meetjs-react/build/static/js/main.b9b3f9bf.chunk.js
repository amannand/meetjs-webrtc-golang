(this["webpackJsonpmeetjs-react"]=this["webpackJsonpmeetjs-react"]||[]).push([[0],{13:function(e,t,n){e.exports=n.p+"static/media/logo.acb38cf1.svg"},32:function(e,t,n){e.exports=n.p+"static/media/mic-on.5ce2865f.svg"},33:function(e,t,n){e.exports=n.p+"static/media/mic-off.99246803.svg"},34:function(e,t,n){e.exports=n.p+"static/media/cam-on.a9c7e91b.svg"},35:function(e,t,n){e.exports=n.p+"static/media/cam-off.60765bda.svg"},36:function(e,t,n){e.exports=n.p+"static/media/view.d319b0ef.svg"},39:function(e,t,n){e.exports=n(71)},44:function(e,t,n){},45:function(e,t,n){},69:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(30),o=n.n(c),s=(n(44),n(9)),i=n(1),u=(n(45),n(13)),l=n.n(u),_=n(16),m=n.n(_);function d(e){return m.a.get("".concat("https://meetjs.tk","/connect"),{params:{url:e}})}var f,p=function(){var e=Object(a.useState)(""),t=Object(i.a)(e,2),n=t[0],c=t[1],o=Object(a.useState)(""),u=Object(i.a)(o,2),_=u[0],d=u[1],f=Object(a.useState)(""),p=Object(i.a)(f,2),b=p[0],h=p[1],v=Object(s.e)();return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"header__left"},r.a.createElement("img",{src:l.a,alt:"Logo",className:"header__left__logo"}),r.a.createElement("span",{className:"header__left__text"},"MeetJS")),r.a.createElement("div",{className:"header__right"},r.a.createElement("span",{className:"header__right__margin"},"Github"),r.a.createElement("span",null,"About"))),r.a.createElement("div",{className:"body"},r.a.createElement("span",{className:"body__title"},"Do you want a free video chat platform?"),r.a.createElement("span",{className:"body__sub-title"},"Get you own URL and share it with others to join you."),r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),function(e,t,n){return m.a.post("".concat("https://meetjs.tk","/session"),JSON.stringify({title:t,host:e,password:n}))}(n,_,b).then((function(e){v.push("/meeting/".concat(e.data.socket))})).catch((function(e){console.error(e.message)}))},className:"body__form"},r.a.createElement("div",{className:"body__form__inputs"},r.a.createElement("input",{placeholder:"Host",className:"body__form__inputs__input",type:"text",value:n,onChange:function(e){return c(e.target.value)},required:!0,autoComplete:"on"}),r.a.createElement("input",{placeholder:"Title",className:"body__form__inputs__input",type:"text",value:_,onChange:function(e){return d(e.target.value)},required:!0,autoComplete:"on"}),r.a.createElement("input",{placeholder:"Password",className:"body__form__inputs__input",type:"password",value:b,onChange:function(e){return h(e.target.value)},required:!0,autoComplete:"on"})),r.a.createElement("div",{className:"body__form__create"},r.a.createElement("button",{className:"body__form__create__btn",type:"submit"},"Create"),r.a.createElement("span",{className:"body__form__create__small-text"},"Secure and simple")))))},b=n(37),h=n(2),v=n.n(h),g=n(8),y=n(32),O=n.n(y),E=n(33),N=n.n(E),j=n(34),w=n.n(j),D=n(35),I=n.n(D),k=n(36),C=n.n(k),S=(n(69),function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),c=n[0],o=n[1],s=Object(a.useState)(""),u=Object(i.a)(s,2),l=u[0],_=u[1],m=Object(a.useState)(!1),d=Object(i.a)(m,2),f=d[0],p=d[1];return r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"modal__wrapper"},r.a.createElement("div",{className:"modal__wrapper__body"},r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.connect(c,l),p(!0)},className:"modal__wrapper__body__form",action:"submit"},r.a.createElement("span",{className:"modal__wrapper__body__form__small-text"},"Connect with your friends"),r.a.createElement("span",{className:"modal__wrapper__body__form__big-text"},"Enter your session credentials"),r.a.createElement("input",{placeholder:"Host",className:"modal__wrapper__body__form__input",type:"text",value:c,onChange:function(e){return o(e.target.value)},required:!0,autoComplete:"on"}),r.a.createElement("input",{placeholder:"Password",className:"modal__wrapper__body__form__input",value:l,onChange:function(e){return _(e.target.value)},type:"password",required:!0,autoComplete:"on"}),r.a.createElement("button",{className:"modal__wrapper__body__form__connect",type:"submit"},"Connect"),e.error&&f&&r.a.createElement("span",{className:"modal__wrapper__body__form-error"},"Invalid credentials")))))}),x=(n(70),n(14)),J=n(15),L=function(){function e(t){Object(x.a)(this,e),this.connection=void 0,this.connection=new WebSocket(t)}return Object(J.a)(e,[{key:"disconnect",value:function(){this.connection.close()}},{key:"onOpen",value:function(e){this.connection.onopen=e}},{key:"send",value:function(e,t){this.connection.send(JSON.stringify({type:e,userID:t}))}},{key:"sendDescription",value:function(e,t,n,a){this.connection.send(JSON.stringify({type:e,userID:n,description:JSON.stringify(t),to:a}))}},{key:"candidate",value:function(e,t){this.connection.send(JSON.stringify({candidate:JSON.stringify(e),userID:t,type:"ice"}))}},{key:"onMessage",value:function(e){this.connection.onmessage=e}},{key:"isReady",value:function(){return this.connection.readyState===this.connection.OPEN}}]),e}();function A(e){return("0"+e.toString(16)).slice(-2)}!function(e){e[e.VALID_URL=1]="VALID_URL",e[e.INVALID=2]="INVALID",e[e.LOGGED=3]="LOGGED",e[e.JOINED=4]="JOINED"}(f||(f={}));var R={iceServers:[{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]},G=function(){function e(t,n){var a=this;Object(x.a)(this,e),this.servers=void 0,this.stream=void 0,this.peerConnection=void 0,this.servers=t,this.stream=n,this.peerConnection=new RTCPeerConnection(t),this.stream.getTracks().forEach((function(e){a.peerConnection.addTrack(e)}))}return Object(J.a)(e,[{key:"createOffer",value:function(){var e=Object(g.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peerConnection.createOffer();case 2:return t=e.sent,this.peerConnection.setLocalDescription(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createAnswer",value:function(){var e=Object(g.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peerConnection.createAnswer();case 2:return t=e.sent,this.peerConnection.setLocalDescription(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"receiveAnswer",value:function(){var e=Object(g.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.peerConnection.setRemoteDescription(new RTCSessionDescription(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addCandidate",value:function(){var e=Object(g.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peerConnection.addIceCandidate(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrack",value:function(e){this.peerConnection.ontrack=e}},{key:"onIceCandidate",value:function(e){this.peerConnection.onicecandidate=e}},{key:"setRemoteDescription",value:function(){var e=Object(g.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.peerConnection.setRemoteDescription(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addIceCandidate",value:function(e){this.peerConnection.addIceCandidate(e)}},{key:"disconnect",value:function(){this.peerConnection.close()}}]),e}(),T=n(38),V=function(){var e=Object(s.f)(),t=Object(a.useState)(f.INVALID),n=Object(i.a)(t,2),c=n[0],o=n[1],u=Object(a.useState)(""),_=Object(i.a)(u,2),p=_[0],h=_[1],y=Object(a.useState)(),E=Object(i.a)(y,2),j=E[0],D=E[1],k=Object(a.useState)(),x=Object(i.a)(k,2),J=x[0],V=x[1],M=Object(a.useState)(!1),U=Object(i.a)(M,2),P=U[0],q=U[1],W=Object(a.useState)(),B=Object(i.a)(W,2),H=B[0],$=B[1],z=Object(a.useState)([]),F=Object(i.a)(z,2),K=F[0],Q=F[1],X=Object(a.useState)(""),Y=Object(i.a)(X,2),Z=Y[0],ee=Y[1],te=Object(a.useState)(e.pathname.split("/meeting/")[1]),ne=Object(i.a)(te,1)[0],ae=Object(a.useState)(),re=Object(i.a)(ae,2),ce=re[0],oe=re[1],se=Object(a.useRef)(null),ie=Object(a.useRef)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=new Uint8Array(e/2);return window.crypto.getRandomValues(t),Array.from(t,A).join("")}());Object(T.a)((function(e){e.preventDefault(),H&&H.send("disconnect",ie.current)})),Object(a.useEffect)((function(){var e=!1;return function(){var t=Object(g.a)(v.a.mark((function t(){return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d(ne);case 3:e||o(f.VALID_URL),t.next=11;break;case 6:t.prev=6,t.t0=t.catch(0),console.log(t.t0.message),console.error("Invalid URL"),window.location.href="/";case 11:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}()(),function(){e=!0}}),[ne]);return Object(a.useEffect)((function(){c>=3&&se.current&&!se.current.srcObject&&navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){se.current&&(se.current.srcObject=e),oe(e),D(!0),V(!0)})).catch((function(e){console.log(e)}))}),[c]),Object(a.useEffect)((function(){ce&&ce.getTracks().forEach((function(e){"audio"===e.kind&&(e.enabled=!e.enabled)}))}),[ce,j]),Object(a.useEffect)((function(){ce&&ce.getTracks().forEach((function(e){"video"===e.kind&&(e.enabled=!e.enabled)}))}),[ce,J]),Object(a.useEffect)((function(){3===c&&H&&(H.send("disconnect",ie.current),Q([]))}),[c,H]),Object(a.useEffect)((function(){if(c>3){var e=new L("".concat("wss://meetjs.tk/ws","/").concat(Z)),t=[],n=[];e.onOpen((function(){e.send("connect",ie.current)})),e.onMessage((function(a){var r=JSON.parse(a.data);switch(n[r.userID]||ie.current===r.userID||(t[r.userID]||(t[r.userID]=new MediaStream),se.current&&se.current.srcObject&&(n[r.userID]=new G(R,se.current.srcObject)),n[r.userID].onIceCandidate((function(t){t.candidate&&e.candidate(t.candidate,ie.current)})),n[r.userID].onTrack((function(e){var n=t[r.userID];n.addTrack(e.track),document.getElementById("".concat(r.userID,"-video")).srcObject=n}))),r.type){case"session_joined":e.send("start_call",ie.current);break;case"start_call":r.userID!==ie.current&&(Q((function(e){return e.indexOf(r.userID)<0?e.concat(r.userID):e})),n[r.userID].createOffer().then((function(t){e.sendDescription("offer",t,ie.current,r.userID)})));break;case"offer":r.to===ie.current&&(Q((function(e){return e.indexOf(r.userID)<0?e.concat(r.userID):e})),n[r.userID].setRemoteDescription(new RTCSessionDescription(JSON.parse(r.description))).then(Object(g.a)(v.a.mark((function t(){var a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n[r.userID].createAnswer();case 2:a=t.sent,e.sendDescription("answer",a,ie.current,r.userID);case 4:case"end":return t.stop()}}),t)})))));break;case"answer":r.to===ie.current&&n[r.userID].receiveAnswer(JSON.parse(r.description));break;case"ice":ie.current!==r.userID&&r.candidate&&n[r.userID].addIceCandidate(JSON.parse(r.candidate));break;case"disconnect":r.userID!==ie.current&&(Q((function(e){var t=Object(b.a)(e);return t.splice(t.indexOf(r.userID),1),t})),t[r.userID]=void 0,n[r.userID]=void 0)}})),$(e)}}),[c,Z]),r.a.createElement("div",{className:"meeting"},r.a.createElement("div",{className:"meeting__header"},r.a.createElement("div",{className:"meeting__header__left"},r.a.createElement("img",{src:l.a,alt:"Logo",className:"meeting__header__left__logo"}),r.a.createElement("span",{className:"meeting__header__left__text"},"MeetJS")),r.a.createElement("div",{className:"meeting__header__right"},r.a.createElement("span",{className:"meeting__header__right__margin"},"Github"),r.a.createElement("span",null,"About"))),r.a.createElement("div",{className:"meeting__body"},c<=2&&r.a.createElement(S,{error:c===f.INVALID,connect:function(e,t){(function(e,t,n){return m.a.post("".concat("https://meetjs.tk","/connect/").concat(n),JSON.stringify({host:e,password:t}))})(e,t,ne).then((function(e){e.data.title&&h(e.data.title),e.data.socket&&ee(e.data.socket),o(f.LOGGED)})).catch((function(e){o(f.INVALID)}))}}),c===f.LOGGED&&r.a.createElement("div",{className:"meeting__body__info"},"Join the meeting to communicate with others."),c===f.JOINED&&r.a.createElement("div",{className:"meeting__body__users ".concat(P?"meeting__body__users-row":"meeting__body__users-column")},K.map((function(e,t){return r.a.createElement("video",{key:t,id:"".concat(e,"-video"),autoPlay:!0,className:"meeting__body__users__remote-video ".concat(P?"meeting__body__users__remote-video-split":"")})}))),c>2&&r.a.createElement("div",{className:"meeting__body__bar"},r.a.createElement("div",{className:"meeting__body__bar__video-container"},r.a.createElement("video",{hidden:!J,ref:se,autoPlay:!0,muted:!0,className:"meeting__body__bar__video-container__local-video",id:"local-video"})),r.a.createElement("div",{className:"meeting__body__bar__left-bar"},r.a.createElement("div",{onClick:function(){switch(c){case f.LOGGED:o(f.JOINED);break;case f.JOINED:o(f.LOGGED)}},className:"meeting__body__bar__left-bar__status ".concat(c===f.JOINED?"meeting__body__bar__left-bar__status-inactive":"meeting__body__bar__left-bar__status-active")},c===f.JOINED?"Leave":"Join"),r.a.createElement("span",{className:"meeting__body__bar__left-bar__title"},p)),r.a.createElement("div",{className:"meeting__body__bar__right-bar"},c===f.JOINED&&r.a.createElement("span",{className:"meeting__body__bar__right-bar__count"},K.length," online users"),r.a.createElement("img",{className:"meeting__body__bar__right-bar__icon",src:C.a,alt:"Change view",onClick:function(){return q(!P)}}),r.a.createElement("img",{className:"meeting__body__bar__right-bar__icon",src:j?O.a:N.a,alt:"Mic",onClick:function(){return D(!j)}}),r.a.createElement("img",{className:"meeting__body__bar__right-bar__icon",src:J?w.a:I.a,alt:"Webcam",onClick:function(){return V(!J)}})))))},M=n(7);var U=function(){var e=Object(M.a)();return r.a.createElement("div",{className:"app"},r.a.createElement(s.c,{history:e},r.a.createElement(s.d,null,r.a.createElement(s.b,{exact:!0,path:"/meeting/*"},r.a.createElement(V,null)),r.a.createElement(s.b,{exact:!0,path:"/"},r.a.createElement(p,null)),r.a.createElement(s.b,{path:"*"},r.a.createElement(s.a,{push:!0,to:"/"})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[39,1,2]]]);
//# sourceMappingURL=main.b9b3f9bf.chunk.js.map